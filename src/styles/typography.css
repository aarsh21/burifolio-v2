@reference './global.css';

@layer base {
  p,
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    @apply wrap-break-word;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    @apply text-balance;
  }

  p {
    @apply text-pretty;
  }
}

@layer components {
  .prose {
    @apply text-foreground text-base leading-7;
    @apply [&>link[rel="stylesheet"]+*]:mt-0! [&>link[rel="stylesheet"]+*>*]:mt-0!;

    :where(p):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      @apply text-foreground/80 my-6;
    }

    :where(h1, h2, h3, h4, h5, h6):not(
      :where([class~='not-prose'], [class~='not-prose'] *)
    ) {
      @apply text-foreground scroll-mt-32 font-bold tracking-tight uppercase xl:scroll-mt-20;
    }

    /* Don't use an <h1> in your posts, one is already generated in blog/[...id].astro */
    :where(h1):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      @apply mt-12 mb-6 text-3xl;
    }

    :where(h2):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      @apply border-foreground relative mt-12 mb-6 border-b-2 pb-2 text-2xl;
    }

    :where(h2):not(
        :where([class~='not-prose'], [class~='not-prose'] *)
      )::before {
      content: '//';
      @apply text-accent mr-2;
    }

    :where(h3):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      @apply mt-10 mb-4 text-xl;
    }

    :where(h3):not(
        :where([class~='not-prose'], [class~='not-prose'] *)
      )::before {
      content: '>';
      @apply text-accent mr-2;
    }

    :where(h4):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      @apply mt-8 mb-3 text-lg;
    }

    :where(h5, h6):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      @apply mt-6 mb-3;
    }

    :where(a):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      @apply text-foreground decoration-accent hover:bg-accent hover:text-accent-foreground font-bold break-words underline decoration-2 underline-offset-2 transition-colors;
    }

    :where(strong):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      @apply text-foreground font-bold;
    }

    :where(em):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      @apply border-accent border-l-2 pl-2 not-italic;
    }

    :where(ul):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      @apply my-6 ml-0 list-none space-y-2;
    }

    :where(ul > li):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      @apply relative pl-6;
    }

    :where(ul > li):not(
        :where([class~='not-prose'], [class~='not-prose'] *)
      )::before {
      content: '';
      @apply bg-accent absolute top-3 left-0 h-2 w-2;
    }

    :where(ol):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      counter-reset: list-counter;
      @apply my-6 ml-0 list-none space-y-2;
      @apply [&[type='A']]:list-[upper-alpha] [&[type='I']]:list-[upper-roman] [&[type='a']]:list-[lower-alpha] [&[type='i']]:list-[lower-roman];
    }

    :where(ol > li):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      counter-increment: list-counter;
      @apply relative pl-10;
    }

    :where(ol > li):not(
        :where([class~='not-prose'], [class~='not-prose'] *)
      )::before {
      content: counter(list-counter, decimal-leading-zero);
      @apply text-accent absolute top-0 left-0 text-xs font-bold;
    }

    :where(li):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      @apply text-foreground/80 [&>p]:my-0;
    }

    :where(ul ul, ol ol, ul ol, ol ul):not(
      :where([class~='not-prose'], [class~='not-prose'] *)
    ) {
      @apply my-2 ml-4;
    }

    :where(code):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      @apply bg-muted text-foreground border-foreground/20 relative border px-1.5 py-0.5 text-sm font-medium break-words;
      @apply [&>span[data-line='']>*]:text-(--shiki-light) dark:[&>span[data-line='']>*]:text-(--shiki-dark);
    }

    :where(blockquote):not(
      :where([class~='not-prose'], [class~='not-prose'] *)
    ) {
      @apply border-accent bg-muted/30 my-8 border-l-4 py-4 pr-4 pl-6;
    }

    :where(blockquote p):not(
      :where([class~='not-prose'], [class~='not-prose'] *)
    ) {
      @apply text-foreground/70 my-0 italic;
    }

    :where(blockquote p):not(
        :where([class~='not-prose'], [class~='not-prose'] *)
      )::before {
      content: '"';
      @apply text-accent text-2xl;
    }

    :where(blockquote p):not(
        :where([class~='not-prose'], [class~='not-prose'] *)
      )::after {
      content: '"';
      @apply text-accent text-2xl;
    }

    :where(hr):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      @apply border-foreground my-12 border-t-2;
    }

    :where(table):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      @apply border-foreground my-8 w-full border-collapse border-2 text-sm;
    }

    :where(thead):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      @apply border-foreground bg-muted border-b-2;
    }

    :where(th):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      @apply px-4 py-3 text-left text-xs font-bold tracking-wide uppercase;
      @apply [&[align=center]]:text-center [&[align=right]]:text-right;
    }

    :where(tr):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      @apply border-foreground/20 hover:bg-muted/50 border-b transition-colors;
    }

    :where(td):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      @apply text-foreground/80 px-4 py-3 align-top break-words;
      @apply text-left [&[align=center]]:text-center [&[align=right]]:text-right;
    }

    :where(img, video, figure):not(
      :where([class~='not-prose'], [class~='not-prose'] *)
    ) {
      @apply border-foreground shadow-brutal my-8 border-2;
    }

    :where(.expressive-code):not(
      :where([class~='not-prose'], [class~='not-prose'] *)
    ) {
      @apply my-8;
    }

    :where(.expressive-code .frame):not(
      :where([class~='not-prose'], [class~='not-prose'] *)
    ) {
      @apply border-foreground shadow-brutal! rounded-none! border-2;
    }

    :where(pre):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      @apply max-h-[min(68vh,1000px)]! overflow-y-auto [&::-webkit-scrollbar-corner]:hidden;
    }

    :where(summary):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      @apply border-foreground bg-muted hover:bg-accent hover:text-accent-foreground cursor-pointer border-2 px-4 py-2 text-sm font-bold tracking-wide uppercase transition-colors;
      @apply [&~*]:small [&~*>*]:first:mt-0! [&~*>*]:last:mb-0!;
    }

    :where(details):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      @apply my-6;
    }

    :where(details[open] summary):not(
      :where([class~='not-prose'], [class~='not-prose'] *)
    ) {
      @apply border-b-0;
    }

    :where(details > *:not(summary)):not(
      :where([class~='not-prose'], [class~='not-prose'] *)
    ) {
      @apply border-foreground bg-muted/30 border-2 border-t-0 p-4;
    }

    :where(kbd):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
      @apply text-foreground bg-muted border-foreground shadow-brutal-sm border-2 px-2 py-0.5 text-xs font-bold uppercase;
    }

    :where(.katex-display):not(
      :where([class~='not-prose'], [class~='not-prose'] *)
    ) {
      @apply text-foreground/80 border-foreground bg-muted/30 my-8 overflow-x-auto overflow-y-hidden border-2 p-4 tracking-normal;
    }

    /* Footnotes styling */
    :where(.footnotes):not(
      :where([class~='not-prose'], [class~='not-prose'] *)
    ) {
      @apply border-foreground mt-12 border-t-2 pt-8;
    }

    :where(.footnotes h2):not(
      :where([class~='not-prose'], [class~='not-prose'] *)
    ) {
      @apply text-lg;
    }
  }
}

@utility fix-margin {
  @apply [&>*]:first:mt-0! [&>*]:last:mb-0!;
}

@utility small {
  @apply text-sm leading-6 [&_code]:text-xs [&_img,video,figure,details,blockquote,.katex-display,.expressive-code]:my-4! [&_li,ol]:mt-0 [&_p]:my-2! [&_ul]:my-0;
}
